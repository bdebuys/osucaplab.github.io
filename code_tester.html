<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <!-- Load jQuery -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <!-- Load the jspsych library and plugins -->
        <script src="scripts/jspsych.js"></script>
        <script src="scripts/plugins/jspsych-text.js"></script>
		<script src="scripts/plugins/jspsych-html.js"></script>
        <!-- Load the stylesheet -->
        <link href="experiment.css" type="text/css" rel="stylesheet"></link>
    </head>

    <body>
        <div id="jspsych_target"></div>
    </body>

    <script type="text/javascript">

		// Load stimuli into array for later calling
		var face = ["img/r1.BMP","img/r2.BMP","img/r3.BMP","img/r4.BMP","img/r5.BMP","img/r6.BMP","img/r7.BMP","img/r8.BMP","img/r9.BMP","img/r10.BMP","img/r11.BMP","img/r12.BMP","img/r13.BMP","img/r14.BMP","img/r15.BMP","img/r16.BMP","img/r17.BMP","img/n1.BMP","img/n2.BMP","img/n3.BMP","img/n4.BMP","img/n5.BMP","img/n6.BMP","img/n7.BMP","img/n8.BMP","img/n9.BMP","img/n10.BMP","img/n11.BMP","img/n12.BMP","img/n13.BMP","img/n14.BMP","img/n15.BMP","img/n16.BMP","img/n17.BMP"];//array of image locations
		var face1 = ["img/face1.jpg","img/face2.jpg"];
		// create a function that takes face and shuffles 6 times and creates 6 columns of randomly ordered face stimuli
		var shape=["r","r","r","r","r","r","r","r","r","r","r","r","r","r","r","r","r","n","n","n","n","n","n","n","n","n","n","n","n","n","n","n","n","n"];//will be used for prob assignment
		var face_nat = ["Adok", "Lork"];//group membership options
        var face_disp = ["friendly","hostile"];//disposition choices
		
		//Randomize the stimuli for the experiment 1 block only!! (i.e., 1 CD 1 XD and 1 D)
		function randomize_stimuli(array1){// function to randomize stimuli
			var matrix = [];
			for(var i=0; i<array1.length; i++) {// create matrix to store the stimuli for each condition
				matrix[i] = new Array(3);
					for(var j=0; j<3; j++)
						matrix[i][j] = array1[i];
			}
			// Generating Random Order for Stimuli
			//Fisher-Yates Shuffle copied from bost.ocks.org/mike/shuffle ***********(Academic paper)**************
			for(var z=0;z<3;z++){
				var m = array1.length, t, d;
				// While there remain elements to shuffle…
				while (m) {
				// Pick a remaining element…
				d = Math.floor(Math.random() * m--);
				// And swap it with the current element.
				t = matrix[m][z];
				matrix[m][z] = matrix[d][z];
				matrix[d][z] = t;
				}				
			}
		return matrix;
		}
		
		var stim_block1=randomize_stimuli(face);//uses the above function to create a 3x34 matrix containing a random order of stim for block 1

		
		function setAttribtues(stimuli){//set stimuli attributes based on the input of stimuli
		/* Key for the returned matrix 
		CD
			[any][0] === Face Shape
			[any][1] === Nat Assign
			[any][2] === Disp Assign
		XD
			[any][3] === Face Shape
			[any][4] === Nat Assign
			[any][5] === Disp Assign
		D
			[any][6] === Face Shape
			[any][7] === Nat Assign
			[any][8] === Disp Assign
		*/
			var matrix = [];
			var prob = 0;
			var xd = 0;
			var d = 0;
			var n = 0;
			var prob_nat = 6;//change probability of nat assignment, currently 60% chance of R being Adok, and 60% chance of Narrow being lork
			var prob_disp = 7;// change disp assignment. Currently 70% chance of Adok being Fr and 70% chance of lork being Aggressive
			for(var z=0; z<102; z++) {// create matrix to store the stimuli for each condition
					matrix[z] = new Array(4);
				}
			for(j=0;j<3;j++){ 
				for(var i=0; i<stimuli.length; i++) {
					//number of columns in stim array (can write function to make dynamic)
					if(stimuli[i][j].charAt(4)=="r"){//If stimuli is a round face
						matrix[n][0]="round";
						if(n<34){matrix[n][3]='CD';}
						else if(n>=34){
							if(xd<34 && d<34){matrix[n][3]=Math.floor(Math.random() * ((3-2)+1) + 2);}// randomly either 2 or 3 This may not be the best way to randomize
								if(matrix[n][3]==2){matrix[n][3]='XD';xd+=1;}//Change random number to trial indicator
								else if(matrix[n][3]==3){matrix[n][3]='D';d+=1;}
							else if(xd>=34){matrix[n][3]='D';}
							else if(d>=34){matrix[n][3]='XD';}
						}
						prob = Math.floor((Math.random() * 10) + 1);//random number between 1 and 10
						if(prob<=prob_nat){
							matrix[n][1]="Adok";
							prob = Math.floor((Math.random() * 10) + 1);
							if(prob<=prob_disp){//assign disposition
								matrix[n][2]="Fr";
							}else if (prob>prob_disp){//basically 1-prob_adok_friendly
								matrix[n][2]="Ag";
							}
						}
						else if(prob>prob_nat){
							matrix[n][1]="Lork";
							prob = Math.floor((Math.random() * 10) + 1);
							if(prob<=prob_disp){//assign disposition
								matrix[n][2]="Ag";
							}else if (prob>prob_disp){
								matrix[n][2]="Fr";
							}	
						}
					}
					else if(stimuli[i][j].charAt(4)=="n"){//if stimuli is a narrow face
						matrix[n][0]="narrow";
						if(n<34){matrix[n][3]='CD';}
						else if(n>=34){
							if(xd<34 && d<34){matrix[n][3]=Math.floor(Math.random() * ((3-2)+1) + 2);}// randomly either 2 or 3
								if(matrix[n][3]==2){matrix[n][3]='XD';xd+=1;}
								else if(matrix[n][3]==3){matrix[n][3]='D';d+=1;}
							else if(xd>=34){matrix[n][3]='D';}
							else if(d>=34){matrix[n][3]='XD';}
						}
						prob = Math.floor((Math.random()*10)+1);
						if (prob<=prob_nat){
							matrix[n][1]="Lork";
							prob = Math.floor((Math.random() * 10) + 1);
							if(prob<=prob_disp){
								matrix[n][2]="Ag";
							}else if(prob>prob_disp){
								matrix[n][2]= "Fr";
							}
						} else if (prob>prob_nat){
							matrix[n][1]="Adok";
							prob = Math.floor((Math.random() * 10) + 1);
							if(prob<=prob_disp){
								matrix[n][2]="Fr";
							}else if(prob>prob_disp){
								matrix[n][2]= "Ag";
							}
						}
					}
				matrix[n][4]=stimuli[i][j];
				n+=1;
				}
			}
		return matrix;
		}//close the function
		
		var attributes_block1 = setAttribtues(stim_block1);
		
		
		for (i=0;i<attributes_block1.length;i++)
			{
			document.write(attributes_block1[i] + "<br >");
			}

    </script>
</html>