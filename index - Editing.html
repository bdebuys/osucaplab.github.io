<!DOCTYPE html>
<html>
    <head>
        <title>My experiment</title>
        <!-- Load jQuery -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <!-- Load the jspsych library and plugins -->
        <script src="scripts/jspsych.js"></script>
        <script src="scripts/plugins/jspsych-text.js"></script>
        <script src="scripts/plugins/face_v2.js"></script>
		<script src="scripts/plugins/jspsych-html.js"></script>
        <!-- Load the stylesheet -->
        <link href="experiment.css" type="text/css" rel="stylesheet"></link>
    </head>

    <body>
        <div id="jspsych_target">Please wait a moment while the experiment materials are prepared</div>
    </body>

    <script type="text/javascript">
	// consent form
		var check_consent = function(elem) {
            if ($('#consent_checkbox').is(':checked')) {
                return true;
            }
            else {
                alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
                return false;
            }
        };
		var consent_block = {
				type:'html', 
				pages: [{url: 'consent.html', cont_btn: "start", check_fn: check_consent}]
				};
	
  // Experiment parameters

        // Experiment Instructions
        var welcome_message = "<div id='instructions'><p>Welcome to the " +
            "experiment. Please press enter to begin.</p></div>";

        var instructions = "<div id='instructions'><p>You will see a " +
            "series of faces that belong to one of two groups, " +
            "Adoks or Lorks. You will then be asked to act friendly or " +
            "hostile to the face you are shown. Adoks are typically nice " +
            "while Lorks are typically mean. You should be friendly to faces " +
			"you think are nice, and defensive to faces you believe are mean. " +
            "You will press the 'A' key to be friendly and 'L' key to be mean." +
			"</p><p>Please press enter to start.</p>";

        var debrief = "<div id='instructions'><p>Thank you for " +
            "participating!  Press enter to see the data.</p></div>";

		// Load stimuli into array for later calling
		var face = ["img/r1.BMP","img/r2.BMP","img/r3.BMP","img/r4.BMP","img/r5.BMP","img/r6.BMP","img/r7.BMP","img/r8.BMP","img/r9.BMP","img/r10.BMP","img/r11.BMP","img/r12.BMP","img/r13.BMP","img/r14.BMP","img/r15.BMP","img/r16.BMP","img/r17.BMP","img/n1.BMP","img/n2.BMP","img/n3.BMP","img/n4.BMP","img/n5.BMP","img/n6.BMP","img/n7.BMP","img/n8.BMP","img/n9.BMP","img/n10.BMP","img/n11.BMP","img/n12.BMP","img/n13.BMP","img/n14.BMP","img/n15.BMP","img/n16.BMP","img/n17.BMP"];//array of image locations
		var face1 = ["img/face1.jpg","img/face2.jpg"];
		var shape=["r","r","r","r","r","r","r","r","r","r","r","r","r","r","r","r","r","n","n","n","n","n","n","n","n","n","n","n","n","n","n","n","n","n"];//will be used for prob assignment
		var face_nat = ["Adok", "Lork"];//group membership options
        var face_disp = ["friendly","hostile"];//disposition choices
		
		jsPsych.preloadImages(face);

		// Generating Random Order for Stimuli
		//Fisher-Yates Shuffle copied from bost.ocks.org/mike/shuffle
		
		//shuffle(face,shape);//hopefully shuffles these as if there were consecutive columns of a matrix(i.e., row shuffle)
		// use the above function to shuffle the images

		
		// Define experiment blocks

        var instruction_block = {
                type: "text",
                text: [welcome_message, instructions],
                timing_post_trial: 1500//amount of time after the instructions before the experiment
            };

		var CD_block = {
                type: "face-exp",
                stimuli: face,
				prompt1: '<p>Press "A" to categorize the face as an Adok. Press "L" to categorize the face as a Lork.</p>',
				prompt2: '<p>Press "A" to act friendly towards the face you saw. Press "L" to act defensively to towards the face you saw.</p>'
            };

        var debrief_block = {
                type: "text",
                text: [debrief]
            };
		
        jsPsych.init({
            display_element: $('#jspsych_target'),
            experiment_structure: [consent_block,instruction_block,CD_block,debrief_block],
            on_finish: function(data) {
                $("#jspsych_target").append($('<pre>', {
                    html: jsPsych.dataAsCSV()
                }));
				jsPsych.saveCSVdata("data.csv");

            }
        });
    </script>
</html>